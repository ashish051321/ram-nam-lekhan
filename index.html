<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡§∞‡§æ‡§Æ ‡§®‡§æ‡§Æ ‡§≤‡•á‡§ñ‡§®</title>

  <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --font-size: clamp(36px, 6vw, 72px);
      --line-height: 1.6;
      --ink: #111;
      --stroke: #111;
      --fill: #000;
      --paper: #fffef8;
      --rule: #d9e6ff;
      --margin: #ffb3b3;
      --gap: 0.5em;
      --stroke-width: 2.2px;
      --draw-ms: 1200;
      --ink-fade-ms: 250;
    }

    body{
      margin:0;
      min-height:100svh;
      height: 10000px; /* Set a large fixed height to prevent scroll jumping */
      color:var(--ink);
      background:
        url('./lord-ram-background.jpg') center center / cover no-repeat fixed,
        linear-gradient(90deg, transparent 0 64px, var(--margin) 64px 66px, transparent 66px) 0 0/100% 100%,
        repeating-linear-gradient(
          to bottom,
          var(--paper),
          var(--paper) calc(var(--font-size) * var(--line-height) - 2px),
          var(--rule) 0,
          var(--rule) calc(var(--font-size) * var(--line-height))
        );
      font-family: "Kalam", system-ui, -apple-system, "Noto Sans Devanagari", "Noto Sans", sans-serif;
      -webkit-tap-highlight-color: transparent;
      position: relative;
    }
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 254, 248, 0.65);
      z-index: 0;
      pointer-events: none;
    }

    @media (max-width: 768px) {
      body {
        background:
          url('./lord-ram-background.jpg') center center / cover no-repeat fixed,
          linear-gradient(90deg, transparent 0 64px, var(--margin) 64px 66px, transparent 66px) 0 0/100% 100%,
          repeating-linear-gradient(
            to bottom,
            var(--paper),
            var(--paper) calc(var(--font-size) * var(--line-height) - 2px),
            var(--rule) 0,
            var(--rule) calc(var(--font-size) * var(--line-height))
          );
      }
      header {
        font-size: 12px;
        padding: 10px 16px;
        bottom: 12px;
      }
    }

    .wrap{
      max-width: 1000px;
      margin: 0 auto;
      padding: 24px 16px 100px;
      position: relative;
      z-index: 1;
    }

    header{
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(10px);
      padding: 12px 20px;
      font-size: 13px;
      line-height: 1.4;
      color: #555;
      display: flex;
      align-items: center;
      gap: 12px;
      user-select: none;
      border-radius: 30px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      max-width: calc(100% - 32px);
      z-index: 998;
    }
    header .dot{
      width: 8px; height: 8px; border-radius: 50%;
      background: #22c55e;
      box-shadow: 0 0 0 4px #22c55e22;
      flex: none;
    }

    .page{
      font-size: var(--font-size);
      line-height: var(--line-height);
      padding-left: 76px;
      cursor: crosshair;
      word-wrap: break-word;
    }

    .line{
      display: inline;
    }

    .gap{
      display: inline-block;
      width: .35em;
    }

    svg.word{
      display: inline-block;
      height: 1em;
      vertical-align: -0.12em;
      overflow: visible;
    }

    .stroke{
      fill: none;
      stroke: var(--stroke);
      stroke-width: var(--stroke-width);
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke-dasharray: 1000;
      stroke-dashoffset: 1000;
      animation: draw var(--draw-ms) ease forwards;
      filter: drop-shadow(0 0 0.25px rgba(0,0,0,0.15));
    }
    .fill{
      fill: var(--fill);
      opacity: 0;
      animation: ink var(--ink-fade-ms) ease forwards;
      animation-delay: calc(var(--draw-ms) * 1ms);
    }

    @keyframes draw{ to { stroke-dashoffset: 0; } }
    @keyframes ink{ to { opacity: 1; } }

    .hint{
      font-size: 13px;
      color:#666;
      margin-top: 6px;
      padding-left: 76px;
      user-select: none;
    }

    * { -webkit-user-select: none; user-select: none; }

    /* Floating Counter */
    #counter {
      position: fixed;
      top: 12px;
      left: 16px;
      background: rgba(255, 255, 255, 0.25);
      border: 1px solid rgba(255, 255, 255, 0.5);
      border-radius: 12px;
      padding: 6px 14px;
      font-size: 16px;
      font-weight: bold;
      color: #333;
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      z-index: 999;
      transition: transform 0.2s ease, background 0.2s ease;
    }
    #counter.flash {
      transform: scale(1.3);
      background: rgba(234, 255, 234, 0.6);
    }

    /* Toggle Button */
    #toggleButton {
      position: fixed;
      bottom: 190px;
      left: 16px;
      background: rgba(255, 255, 255, 0.25);
      border: 1px solid rgba(255, 255, 255, 0.5);
      border-radius: 12px;
      padding: 8px 16px;
      font-size: 14px;
      font-weight: bold;
      color: #333;
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      z-index: 999;
      transition: transform 0.2s ease, background 0.2s ease;
      cursor: pointer;
      user-select: none;
    }
    #toggleButton:hover {
      transform: scale(1.05);
      background: rgba(255, 255, 255, 0.35);
    }
    #toggleButton:active {
      transform: scale(0.95);
      background: rgba(251, 255, 200, 0.4);
    }
    #toggleButton.disabled {
      background: rgba(213, 255, 200, 0.4);
      color: #666;
    }

    /* Background Switcher Button */
    #backgroundSwitcher {
      position: fixed;
      top: 12px;
      right: 16px;
      background: rgba(255, 255, 255, 0.25);
      border: 1px solid rgba(255, 255, 255, 0.5);
      border-radius: 12px;
      padding: 8px 12px;
      font-size: 14px;
      font-weight: bold;
      color: #333;
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      z-index: 999;
      transition: transform 0.2s ease, background 0.2s ease;
      cursor: pointer;
      user-select: none;
    }
    #backgroundSwitcher:hover {
      transform: scale(1.05);
      background: rgba(255, 255, 255, 0.35);
    }
    #backgroundSwitcher:active {
      transform: scale(0.95);
      background: rgba(251, 255, 200, 0.4);
    }

    /* Hanuman Ji Floating Image */
    #hanuman {
      position: fixed;
      bottom: 16px;
      left: 16px;
      width: 80px;
      height: 80px;
      background: url('./hanumanji.png') center center / contain no-repeat;
      z-index: 998;
      transition: transform 0.1s ease;
      pointer-events: none;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
    }

    /* Chanting rotation animation */
    @keyframes chant {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(5deg); }
      50% { transform: rotate(0deg); }
      75% { transform: rotate(5deg); }
    }

    #hanuman.chanting {
      animation: chant 0.8s ease-in-out;
    }

    /* Sound Toggle Button */
    #soundToggle {
      position: fixed;
      top: 75px;
      left: 16px;
      background: rgba(255, 255, 255, 0.25);
      border: 1px solid rgba(255, 255, 255, 0.5);
      border-radius: 12px;
      padding: 8px 12px;
      font-size: 14px;
      font-weight: bold;
      color: #333;
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      z-index: 999;
      transition: transform 0.2s ease, background 0.2s ease;
      cursor: pointer;
      user-select: none;
    }
    #soundToggle:hover {
      transform: scale(1.05);
      background: rgba(255, 255, 255, 0.35);
    }
    #soundToggle:active {
      transform: scale(0.95);
      background: rgba(251, 255, 200, 0.4);
    }
    #soundToggle.disabled {
      background: rgba(255, 200, 200, 0.4);
      color: #666;
    }
  </style>
</head>
<body>
  <div id="counter">0 ‚úçÔ∏è</div>
  <button id="toggleButton">Start Writing</button>
  <button id="backgroundSwitcher">üé®</button>
  <button id="soundToggle">üîä</button>
  <div id="hanuman"></div>

  <div class="wrap">
    <header>
      <div class="dot" aria-hidden="true"></div>
      <div>
        Tap / click anywhere or press <strong>Space</strong> to keep writing <strong>‚Äú‡§∞‡§æ‡§Æ‚Äù</strong>
      </div>
    </header>

    <main class="page" id="page" aria-label="Writing surface" role="application" tabindex="0">
      <span class="line" id="line"></span>
    </main>

    <!-- <div class="hint">Backspace to remove last word.</div> -->
  </div>

  <script>
    const pageEl = document.getElementById('page');
    const lineEl = document.getElementById('line');
    const counterEl = document.getElementById('counter');
    const toggleButton = document.getElementById('toggleButton');
    const backgroundSwitcher = document.getElementById('backgroundSwitcher');
    const soundToggle = document.getElementById('soundToggle');
    const hanumanEl = document.getElementById('hanuman');
    pageEl.focus({ preventScroll: true });
    let count = 0;
    let isWritingEnabled = true;
    let isSoundEnabled = true;
    
    // Audio element for playing the chant file
    let audioElement;
    
    // Background images array
    const backgroundImages = [
      './lord-ram-background.jpg',
      './Shree Ram Wallpaper Enwallpaper.jpg',
      './raji_hanumanji.jpg',
      './ram_sitaji.jpg',
      './ramji birth.jpg',
      './ramji kevat.jpg',
      './ramji shabri.jpg',
      './ramji_ayodhya.jpg',
      './ramji_combat.jpg',
      './ramji_setu.jpg',
      './ramji2.jpg'
    ];
    let currentBackgroundIndex = 0;

    function createAnimatedRam() {
      const ns = "http://www.w3.org/2000/svg";
      const svg = document.createElementNS(ns, "svg");
      svg.setAttribute("class", "word");
      const textStroke = document.createElementNS(ns, "text");
      textStroke.setAttribute("class", "stroke");
      textStroke.setAttribute("x", "0");
      textStroke.setAttribute("y", "0");
      textStroke.setAttribute("dominant-baseline", "hanging");
      textStroke.setAttribute("font-family", "'Kalam', 'Noto Sans Devanagari', sans-serif");
      textStroke.setAttribute("font-size", "1em");
      textStroke.textContent = "‡§∞‡§æ‡§Æ";

      const textFill = document.createElementNS(ns, "text");
      textFill.setAttribute("class", "fill");
      textFill.setAttribute("x", "0");
      textFill.setAttribute("y", "0");
      textFill.setAttribute("dominant-baseline", "hanging");
      textFill.setAttribute("font-family", "'Kalam', 'Noto Sans Devanagari', sans-serif");
      textFill.setAttribute("font-size", "1em");
      textFill.textContent = "‡§∞‡§æ‡§Æ";

      svg.appendChild(textStroke);
      svg.appendChild(textFill);

      svg.style.position = "absolute";
      svg.style.visibility = "hidden";
      lineEl.appendChild(svg);
      const bbox = textStroke.getBBox();
      const pad = 2;
      const w = Math.ceil(bbox.width + pad * 2);
      const h = Math.ceil(bbox.height + pad * 2);
      svg.setAttribute("viewBox", `${bbox.x - pad} ${bbox.y - pad} ${w} ${h}`);
      svg.style.position = "";
      svg.style.visibility = "";

      const approxLen = Math.max(300, Math.round((bbox.width + bbox.height) * 6));
      textStroke.style.strokeDasharray = approxLen;
      textStroke.style.strokeDashoffset = approxLen;

      return svg;
    }

    function addGap(){
      const gap = document.createElement("span");
      gap.className = "gap";
      gap.textContent = " ";
      lineEl.appendChild(gap);
    }

    function flashCounter(){
      counterEl.classList.add("flash");
      setTimeout(()=>counterEl.classList.remove("flash"), 200);
    }

    function updateCounter(){
      counterEl.textContent = `${count} ‚úçÔ∏è`;
      flashCounter();
    }

    function triggerHanumanChanting() {
      hanumanEl.classList.add('chanting');
      setTimeout(() => {
        hanumanEl.classList.remove('chanting');
      }, 800);
    }

    function initAudio() {
      if (!audioElement) {
        audioElement = new Audio('./chant1_radio.mp3');
        audioElement.volume = 0.3; // Set volume to 30%
        audioElement.preload = 'auto';
      }
    }

    function playRamSound() {
      if (!isSoundEnabled) return;
      
      initAudio();
      
      // Reset audio to beginning and play
      audioElement.currentTime = 0;
      audioElement.play().catch(e => {
        console.log('Audio play failed:', e);
      });
    }

    function toggleSound() {
      isSoundEnabled = !isSoundEnabled;
      if (isSoundEnabled) {
        soundToggle.textContent = "üîä";
        soundToggle.classList.remove('disabled');
        // Play a test sound
        playRamSound();
      } else {
        soundToggle.textContent = "üîá";
        soundToggle.classList.add('disabled');
      }
    }

    function writeRam(){
      if (!isWritingEnabled) return;
      
      // Scroll to bottom of screen
      // window.scrollTo({ top: document.body.scrollHeight, behavior: "smooth" });
      
      // Write Ram
      if (count > 0) addGap();
      const svgWord = createAnimatedRam();
      lineEl.appendChild(svgWord);
      count++;
      updateCounter();
      
      // Trigger Hanuman ji chanting animation
      triggerHanumanChanting();
      
      // Play Ram sound
      playRamSound();
    }

    function toggleWriting() {
      isWritingEnabled = !isWritingEnabled;
      if (isWritingEnabled) {
        toggleButton.textContent = "Pause";
        toggleButton.classList.remove('disabled');
      } else {
        toggleButton.textContent = "Start Writing";
        toggleButton.classList.add('disabled');
      }
    }

    function switchBackground() {
      currentBackgroundIndex = (currentBackgroundIndex + 1) % backgroundImages.length;
      const newImage = backgroundImages[currentBackgroundIndex];
      
      // Update the background image with proper sizing (instant change)
      document.body.style.backgroundImage = `url('${newImage}'), linear-gradient(90deg, transparent 0 64px, var(--margin) 64px 66px, transparent 66px), repeating-linear-gradient(to bottom, var(--paper), var(--paper) calc(var(--font-size) * var(--line-height) - 2px), var(--rule) 0, var(--rule) calc(var(--font-size) * var(--line-height)))`;
      document.body.style.backgroundSize = 'cover, 100% 100%, 100% 100%';
      document.body.style.backgroundPosition = 'center center, 0 0, 0 0';
      document.body.style.backgroundRepeat = 'no-repeat, no-repeat, repeat';
      document.body.style.backgroundAttachment = 'fixed, scroll, scroll';
      
      // Update button text to show current image number
      // backgroundSwitcher.textContent = `üñºÔ∏è ${currentBackgroundIndex + 1}`;
    }

    function removeLast(){
      if (!lineEl.lastChild) return;
      if (lineEl.lastChild.classList?.contains("gap")){
        lineEl.removeChild(lineEl.lastChild);
        if (lineEl.lastChild) lineEl.removeChild(lineEl.lastChild);
      } else {
        lineEl.removeChild(lineEl.lastChild);
      }
      count = Math.max(0, count - 1);
      updateCounter();
    }

    // Initialize toggle button state (writing enabled by default)
    toggleButton.textContent = "Pause";
    toggleButton.classList.remove('disabled');
    
    // Initialize sound toggle button state
    soundToggle.classList.add('disabled');
    
    // Toggle button event listener
    toggleButton.addEventListener("click", toggleWriting);
    
    // Background switcher event listener
    backgroundSwitcher.addEventListener("click", switchBackground);
    
    // Sound toggle event listener
    soundToggle.addEventListener("click", toggleSound);

    document.addEventListener("keydown", (e) => {
      if (e.code === "Space") {
        e.preventDefault();
        writeRam();
      } else if (e.key === "Backspace") {
        e.preventDefault();
        removeLast();
      }
    });

    document.addEventListener("pointerdown", (e) => {
      const tag = (e.target.tagName || "").toLowerCase();
      if (["a","button","input","textarea","select","label"].includes(tag)) return;
      writeRam();
    }, { passive: true });
  </script>
</body>
</html>
